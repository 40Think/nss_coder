graph TB
    %% External Dependencies
    subgraph External["ğŸŒ External Dependencies"]
        AUDIO[("ğŸ¤ Audio File<br/>(any format)")]
        FFMPEG["ğŸ”§ FFmpeg<br/>(conversion)"]
        FFPROBE["ğŸ“Š FFprobe<br/>(duration)"]
        WHISPER_BIN["âš™ï¸ whisper.cpp<br/>(~/whisper.cpp/build/bin/whisper-cli)"]
        WHISPER_MODEL["ğŸ§  GGML Model<br/>(ggml-large-v3.bin, 3GB)"]
        GPU["ğŸ® NVIDIA GPU<br/>(CUDA acceleration)"]
    end
    
    %% Code Dependencies
    subgraph CodeDeps["ğŸ“¦ Code Dependencies"]
        LOGGER["ğŸ“ DocsLogger<br/>(docs.utils.docs_logger)"]
        STDLIB["ğŸ Python stdlib<br/>(subprocess, tempfile, json)"]
    end
    
    %% Main Processing Pipeline
    subgraph Pipeline["ğŸ”„ VoiceWhisper Pipeline"]
        INIT["ğŸš€ __init__<br/>(validate paths)"]
        HEALTH["ğŸ’Š check_health<br/>(verify readiness)"]
        
        subgraph Transcribe["ğŸ“ transcribe() - Main Flow"]
            VALIDATE["âœ… Validate<br/>(binary/model/audio)"]
            GET_DUR["â±ï¸ _get_audio_duration<br/>(ffprobe)"]
            CONVERT["ğŸ”„ _convert_to_wav16k<br/>(ffmpeg â†’ 16kHz WAV)"]
            EXEC_WHISPER["ğŸ¯ Execute whisper.cpp<br/>(-l ru -oj -np)"]
            PARSE_JSON["ğŸ“‹ Parse JSON<br/>(extract segments)"]
            EXTRACT["ğŸ“¤ Extract Text<br/>(join segments)"]
        end
    end
    
    %% Output
    subgraph Output["ğŸ“Š Output"]
        RESULT["ğŸ“„ TranscriptionResult<br/>(text, language, duration, error)"]
    end
    
    %% Temporary Files
    subgraph Temp["ğŸ—‚ï¸ Temporary Files"]
        TEMP_DIR["ğŸ“ /tmp/whisper_txn_*"]
        TEMP_WAV["ğŸµ convert_*.wav<br/>(16kHz mono)"]
        TEMP_JSON["ğŸ“‹ output.json<br/>(whisper output)"]
    end
    
    %% Data Flow
    AUDIO --> VALIDATE
    WHISPER_BIN --> INIT
    WHISPER_MODEL --> INIT
    LOGGER --> INIT
    
    INIT --> HEALTH
    INIT --> VALIDATE
    
    VALIDATE --> GET_DUR
    AUDIO --> GET_DUR
    FFPROBE --> GET_DUR
    
    GET_DUR --> CONVERT
    AUDIO --> CONVERT
    FFMPEG --> CONVERT
    CONVERT --> TEMP_WAV
    
    TEMP_WAV --> EXEC_WHISPER
    WHISPER_BIN --> EXEC_WHISPER
    WHISPER_MODEL --> EXEC_WHISPER
    GPU -.->|optional| EXEC_WHISPER
    
    EXEC_WHISPER --> TEMP_JSON
    TEMP_JSON --> PARSE_JSON
    PARSE_JSON --> EXTRACT
    EXTRACT --> RESULT
    
    TEMP_WAV -.->|cleanup| TEMP_DIR
    TEMP_JSON -.->|cleanup| TEMP_DIR
    
    %% Process Management
    STDLIB -->|subprocess| EXEC_WHISPER
    STDLIB -->|tempfile| TEMP_DIR
    STDLIB -->|json| PARSE_JSON
    
    LOGGER -.->|logging| VALIDATE
    LOGGER -.->|logging| CONVERT
    LOGGER -.->|logging| EXEC_WHISPER
    
    %% Styling
    classDef external fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef code fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef temp fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef output fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px
    
    class AUDIO,FFMPEG,FFPROBE,WHISPER_BIN,WHISPER_MODEL,GPU external
    class LOGGER,STDLIB code
    class INIT,HEALTH,VALIDATE,GET_DUR,CONVERT,EXEC_WHISPER,PARSE_JSON,EXTRACT process
    class TEMP_DIR,TEMP_WAV,TEMP_JSON temp
    class RESULT output
